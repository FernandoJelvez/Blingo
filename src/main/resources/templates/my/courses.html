<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My courses - Lingdyo</title>
    <link rel="stylesheet" th:href="@{../css/core-style.css}">
    <link rel="stylesheet" th:href="@{../css/courses-style.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Alan+Sans&amp;family=Inconsolata:wght@200..900&amp;display=swap" rel="stylesheet">
</head>
<body>
<nav class="top-nav">
    <ul>
        <li class="navbar-element alan-sans-title"><a href="/my/home">Home</a></li>
        <li class="navbar-element alan-sans-title current-page"><a href="/my/courses">Courses</a></li>
        <li class="navbar-element alan-sans-title"><a href="/dictionary">Dictionary</a></li>
        <li class="navbar-element alan-sans-title" style="float: right;"><a href="/about">About</a></li>
    </ul>
</nav>
<div class="content">
    <div class="main-content">
        <h1 class="alan-sans-title" style="color: #11467F;">My courses</h1>
        <p class="inconsolata-body">Lingdyo is a cooperative Language Learning Platform where you can learn a language at the same time
            you work with other to teach a language you already know, there's no pressure to do both, you are the one who
            chooses what to do</p>
            <button id="courses-view-switch" onclick="switchCoursesView()" style="color: #f5f5f5; background-color: #11467F">Show Available</button>
        <div id="courses-list">
        </div>
    </div>
    <div class="sidebar">
        <header class="language-banner alan-sans-title"><p>Current language: None</p><hr style="border-color: #0D9C92" /></header>
        <div class="board">
            <h3 class="alan-sans-title" style="color:#000020">mmm... maybe <a href="../create/course" style="color: #0D9CFF; text-decoration: none;">create a new course?</a> </h3>
        </div>
        <div class="profile-box" style="">
            <a class="alan-sans-title profile-link" href="/my/profile"><div>
                <img th:src="@{../images/no_user.png}" height="144px" width="144px">
                <p id="username" style="margin: 50px;" th:text="${username}">"</p>
            </div></a>
        </div>
    </div>
</div>

<script>
    window.onload = async function() {
        await loadCoursesCapsules();
        hideNotEnrolledCourses();
    }

    async function loadCoursesCapsules() {
        var courses;
        var usernameParagraph = document.getElementById("username")
        const url = "/available_courses_with_state?username=" + usernameParagraph.textContent;
        try {
            const response = await fetch(url);
            if(!response.ok){
                throw new Error(`Response status: ${response.status}`);
            }
            const result = await response.json();
            for (var i = 0; i<result.length; i++){
                var r = result[i];
                addCourseCapsule(r.creator,r.name,r.likes,r.level,r.language,r.is_enrolled);
            }
        } catch(error) {
            console.log(error.message);
        }
    }
    function addCourseCapsule(creator,name,likes,level,language,is_enrolled){
        var enrolledCoursesList = document.getElementById('courses-list');
        var courseCapsule = document.createElement("div");
        var courseCapsuleClass = document.createAttribute("class");
        var header = document.createElement("header");
        var headerClass = document.createAttribute("class");
        var courseTitle = document.createElement("h1");
        var courseTitleClass = document.createAttribute("class");
        var likesText = document.createElement("h4");
        var likesTextClass = document.createAttribute("class");
        var creatorFooter = document.createElement("footer");
        var creatorFooterClass = document.createAttribute("class");
        var creatorFooterStyle = document.createAttribute("style");

        courseCapsuleClass.value = "content-capsule";
        courseCapsuleIsEnrolled = is_enrolled;
        courseCapsule.setAttributeNode(courseCapsuleClass);
        courseCapsule.setAttribute("data-enrolled",is_enrolled);

        headerClass.value = "inconsolata-body";
        header.setAttributeNode(headerClass);
        header.textContent =  language + " - " + level;

        courseTitleClass.value = "alan-sans-title";
        courseTitle.setAttributeNode(courseTitleClass);
        courseTitle.textContent = name;

        likesTextClass.value = "inconsolata-body";
        likesText.setAttributeNode(likesTextClass);
        likesText.textContent = likes + " Likes"

        creatorFooterClass.value = "inconsolata-body";
        creatorFooterStyle.value = "float: right; margin-top: 10px"
        creatorFooter.setAttributeNode(creatorFooterClass);
        creatorFooter.setAttributeNode(creatorFooterStyle);
        creatorFooter.textContent = "Created by: " + creator;

        courseCapsule.append(header);
        courseCapsule.append(courseTitle);
        courseCapsule.append(likesText);
        courseCapsule.append(creatorFooter);
        enrolledCoursesList.append(courseCapsule);


        console.log("added");
    }
    let courseView = 0;
    function switchCoursesView(){
        const coursesListElement = document.getElementById("courses-list");
        const switchButton = document.getElementById("courses-view-switch"); 

        if (courseView==0){
            switchButton.textContent="Show enrolled"
            showNotEnrolledCourses();
            courseView=1;
        } else if (courseView==1){
            hideNotEnrolledCourses();
            switchButton.textContent="Show available"
            courseView=0;
        }
    }
    function hideNotEnrolledCourses(){
        const notEnrolledCoursesCapsules = document.querySelectorAll('div[data-enrolled="false"]');
        console.log(notEnrolledCoursesCapsules.length);
        for (var i = 0; i < notEnrolledCoursesCapsules.length; i++) {
            notEnrolledCoursesCapsules[i].setAttribute("style","display: none");
        }
    }
    function showNotEnrolledCourses(){
        const notEnrolledCoursesCapsules = document.querySelectorAll('div[data-enrolled="false"]');
        console.log(notEnrolledCoursesCapsules.length);
        for (var i = 0; i < notEnrolledCoursesCapsules.length; i++) {
            notEnrolledCoursesCapsules[i].setAttribute("style","");
        }
    }

</script>
</body>
</html>